
<div class="collaboration-editor">
    <div class="collaboration-header">
        <div class="collaboration-info">
            <div class="collaboration-icon">
                <i class="fas ${tab.type === 'duel' ? 'fa-user-friends' : 'fa-users'}"></i>
            </div>
            <div class="collaboration-title">
                <div>${tab.name}</div>
                <div class="collaboration-task-title">Задача: asdasdas</div>
            </div>
            <div class="collaboration-status">
                <span class="status-badge">${tab.type === 'duel' ? 'Дуэль' : 'Совместная работа'}</span>
                ${this.isConnected ?
                '<span class="connection-status connected"><i class="fas fa-wifi"></i> Online</span>' :
                '<span class="connection-status disconnected"><i class="fas fa-wifi-slash"></i> Offline</span>'}
            </div>
        </div>
        <div class="collaboration-controls">
            <div class="participants-display">
                ${tab.participants ? tab.participants.map(p => `
                <div class="participant-mini" title="${p.username}">
                    <div class="participant-mini-avatar">${p.avatar}</div>
                </div>
                `).join('') : ''}
            </div>
            <button class="tab-run-btn" id="tabRunBtn">
                <i class="fas fa-play"></i> Проверить решение
            </button>
        </div>
    </div>

    <div class="task-description">
        <div class="task-description-content">
            <strong>Задача:</strong> ${tab.task.description}
        </div>
    </div>

    <div class="collaboration-participants">
        ${tab.participants ? tab.participants.map((participant, index) => `
        <div class="collaboration-participant ${participant.username === this.currentUser.username ? 'current-user' : ''}">
            <div class="participant-header">
                <div class="participant-info">
                    <div class="participant-avatar">${participant.avatar}</div>
                    <div class="participant-name">
                        ${participant.username}
                        ${participant.username === this.currentUser.username ? ' (Вы)' : ''}
                    </div>
                </div>
                <div class="participant-status">
                    <span class="status-active"><i class="fas fa-circle"></i> Online</span>
                </div>
            </div>
            <div class="code-mirror-wrapper">
                <textarea class="collaboration-code-editor" id="codeEditor_${index}">
                                    ${participant.username === this.currentUser.username ? tab.content : ''}
                                </textarea>
            </div>
        </div>
        `).join('') : `
        <div class="collaboration-participant current-user">
            <div class="participant-header">
                <div class="participant-info">
                    <div class="participant-avatar">${this.currentUser.avatar}</div>
                    <div class="participant-name">
                        ${this.currentUser.username} (Вы)
                    </div>
                </div>
                <div class="participant-status">
                    <span class="status-active"><i class="fas fa-circle"></i> Online</span>
                </div>
            </div>
            <div class="code-mirror-wrapper">
                <textarea class="collaboration-code-editor" id="codeEditor_0">${tab.content}</textarea>
            </div>
        </div>
        `}
    </div>

    <div class="chat-section">
        <div class="chat-header">
            <i class="fas fa-comments"></i> Чат
            <span class="chat-counter" id="chatCounter">0</span>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" placeholder="Введите сообщение..." id="chatInput">
            <button id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="console-container">
        <div class="console-header">
            <div class="console-title">
                <i class="fas fa-terminal"></i> Результаты проверки
            </div>
            <div class="console-actions">
                <button class="console-btn" id="toggleChatBtn">
                    <i class="fas fa-comments"></i> Чат
                </button>
                <button class="console-btn" id="clearConsoleBtn">
                    <i class="fas fa-broom"></i> Очистить
                </button>
            </div>
        </div>
        <div class="console-output" id="consoleOutput">
            <div class="console-line info">${tab.type === 'duel' ? 'Дуэль программирования начата' : 'Совместная сессия начата'}</div>
            <div class="console-line info">Задача: ${tab.task.title}</div>
            <div class="console-line info">Участники: ${tab.participants ? tab.participants.map(p => p.username).join(', ') : this.currentUser.username}</div>
            ${this.isConnected ?
            '<div class="console-line success">✓ Подключено к серверу</div>' :
            '<div class="console-line error">✗ Нет подключения к серверу</div>'}
        </div>
    </div>
</div>
